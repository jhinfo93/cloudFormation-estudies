Resources:
  CodePipelineServiceRole:
      Type: AWS::IAM::Role
      Properties:
        RoleName: !Join ["-", [!Ref "AWS::StackName" , "role"]] 
        Path: /
        AssumeRolePolicyDocument: |
          {
            "Statement": [{
              "Effect": "Allow",
              "Principal": { "Service": [ "codepipeline.amazonaws.com" ]},
              "Action": [ "sts:AssumeRole" ]
            }]
          }

        Policies:
          - PolicyName: root
            PolicyDocument:
              Version: 2012-10-17
              Statement:
                - Resource: arn:aws:s3:::*
                  Effect: Allow
                  Action:
                    - s3:PutObject
                    - s3:GetObject
                    - s3:GetObjectVersion
                    - s3:GetBucketVersioning
                - Resource: "*"
                  Effect: Allow
                  Action:
                    - codepipeline:*
                    - codebuild:StartBuild
                    - codebuild:BatchGetBuilds
                    - cloudformation:*
                    - cloudwatch:*
                    - events:*
                    - iam:PassRole
                    - secretsmanager:*
                    - ec2:*